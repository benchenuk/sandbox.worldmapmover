(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const u of a.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();const l=L.map("map",{zoomControl:!1,minZoom:2,worldCopyJump:!0,maxBounds:[[-90,-180],[90,180]]}).setView([15,0],3);L.control.zoom({position:"bottomright"}).addTo(l);L.tileLayer("https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}).addTo(l);let c,g,i=null,s=null,d=!1,f=null,w=null,b=!1;const M=document.getElementById("snap-lat-toggle"),T=document.getElementById("reset-btn");fetch("countries.json").then(e=>e.json()).then(e=>{c=L.geoJSON(e,{style:{fillColor:"#cbd5e1",weight:1,opacity:1,color:"#94a3b8",fillOpacity:.6},onEachFeature:P}).addTo(l),D(e)}).catch(e=>console.error("Error loading GeoJSON:",e));function D(e){g=L.layerGroup().addTo(l),e.features.forEach(o=>{const n=o.properties.name||o.properties.admin||"";if(!n)return;const r=I(o.geometry);if(!r)return;const t=L.marker([r.lat,r.lng],{icon:L.divIcon({className:"country-label",html:`<span class="country-label-text" data-country-id="${o.id}">${n}</span>`,iconSize:null}),interactive:!1,pane:"markerPane"});t.featureId=o.id,t.addTo(g)})}function I(e){let o=[];if(e.type==="Polygon")o=e.coordinates[0];else if(e.type==="MultiPolygon"){let t=e.coordinates[0][0];e.coordinates.forEach(a=>{a[0].length>t.length&&(t=a[0])}),o=t}else return null;let n=0,r=0;return o.forEach(t=>{r+=t[0],n+=t[1]}),{lat:n/o.length,lng:r/o.length}}function v(e=null,o="default"){g&&g.eachLayer(n=>{const r=n.getElement();if(!r)return;const t=r.querySelector(".country-label-text");t&&(e&&n.featureId===e?o==="selected"?(t.style.opacity="1",t.style.fontWeight="600",t.style.fontSize="14px"):o==="hover"&&(t.style.opacity="0.9",t.style.fontWeight="500"):(t.style.opacity="0.3",t.style.fontWeight="400",t.style.fontSize="12px"))})}function C(){g&&g.eachLayer(e=>{const o=e.getElement();if(!o)return;const n=o.querySelector(".country-label-text");n&&(n.style.opacity="0.5",n.style.fontWeight="400",n.style.fontSize="12px")})}function P(e,o){o.on({mouseover:z,mouseout:F,click:G})}function z(e){if(s&&e.target.feature.id===s.id)return;const o=e.target;o.setStyle({weight:2,color:"#64748b",fillOpacity:.8}),o.bringToFront(),v(e.target.feature.id,"hover")}function F(e){s&&e.target.feature.id===s.id||(c.resetStyle(e.target),s?v(s.id,"selected"):C())}function G(e){if(d)return;i&&(i.off("mousedown",S),l.off("mousemove",O),l.off("mouseup",E),l.removeLayer(i),i=null),s&&c&&c.resetStyle(c.getLayer(c.getLayerId(s)));const o=e.target;s=feature=o.feature,JSON.parse(JSON.stringify(feature)),o.setStyle({fillOpacity:.2,weight:1,color:"#e2e8f0"}),i=L.geoJSON(feature,{style:{fillColor:"#3b82f6",weight:2,opacity:1,color:"#2563eb",fillOpacity:.7,className:"floating-country"}}).addTo(l),v(s.id,"selected"),i.on("mousedown",S),l.on("mousemove",O),l.on("mouseup",E)}function S(e){i&&(L.DomEvent.stopPropagation(e.originalEvent),L.DomEvent.preventDefault(e.originalEvent),d=!0,l.dragging.disable(),f=e.latlng,w=JSON.parse(JSON.stringify(i.toGeoJSON().features[0].geometry.coordinates)))}function O(e){if(!d||!i)return;const o=e.latlng;let n=o.lat-f.lat;const r=o.lng-f.lng;b&&(n=0);const t=85,a=Math.max(-t,Math.min(t,f.lat)),u=b?f.lat:o.lat,m=Math.max(-t,Math.min(t,u)),y=Math.PI/180,p=Math.cos(a*y),N=Math.cos(m*y),J=N>.001?p/N:1,h=JSON.parse(JSON.stringify(i.toGeoJSON().features[0]));h.geometry.coordinates=x(w,n,r,f.lng,J,h.geometry.type),i.clearLayers(),i.addData(h)}function E(){d=!1,l.dragging.enable()}function x(e,o,n,r,t,a){if(typeof e[0]=="number"){const u=e[0],m=e[1],y=r+n+(u-r)*t,p=m+o;return[y,p]}return e.map(u=>x(u,o,n,r,t))}M.addEventListener("change",e=>{b=e.target.checked});T.addEventListener("click",()=>{i&&(i.off("mousedown",S),l.off("mousemove",O),l.off("mouseup",E),l.removeLayer(i),i=null),s&&c&&(c.resetStyle(c.getLayer(c.getLayerId(s))),s=null),d=!1,l.dragging.enable(),C()});
